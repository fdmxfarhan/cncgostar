link(rel="stylesheet", href="/css/layout/nav.css")
nav.navbar
  .navbar-right
    a.logo(href='/')
      img(src='/img/logo.png' alt='CNC Bartar Logo')
    .mobile-menu-btn
      span
      span
      span
    .nav-links-container
      ul.nav-links
        li
          a(href='/') صفحه اصلی
        li.dropdown
          a خدمات ما
          .dropdown-content
            .dropdown-column
              h3 خدمات سه محور
              a(href='/content?title=mokhaberat') مخابراتی
              a(href='/content?title=pezeshki') تجهیزات پزشکی
              a(href='/content?title=petroshimi') پتروشیمی
              a(href='/content?title=sanati') صنعتی
            .dropdown-column
              h3 خدمات چهار محور
              a(href='/content?title=mardon') ماردون
              a(href='/content?title=ghaltak') غلتک
              a(href='/content?title=implare') ایمپلر (بلسیک)
              a(href='/content?title=index') ایندکس (Indexing)
              a(href='/content?title=screw') اسکرو (Screw)
            .dropdown-column
              h3 خدمات قالب سازی
              a(href='/content?title=tazrigh') تزریق پلاستیک
              a(href='/content?title=sonbe') سنبه ماتریس
        li.dropdown
          a مقالات
          .dropdown-content
            .dropdown-column
              h3 مقالات فنی
              a(href='/articles?category=') مقالات CNC
              a(href='/articles?category=') مقالات لیزر
              a(href='/articles?category=') مقالات واترجت
              a(href='/articles?category=') مقالات پلاسما
            .dropdown-column
              h3 مقالات آموزشی
              a(href='/articles?category=') آموزش‌ها
              a(href='/articles?category=') راهنماها
              a(href='/articles?category=') نکات کاربردی
            .dropdown-column
              h3 اخبار و رویدادها
              a(href='/articles?category=') اخبار صنعت
              a(href='/articles?category=') اخبار شرکت
              a(href='/articles?category=') رویدادها
        li
          a(href="#aboutus-content")  درباره ما
        li
          a#contact-us-btn تماس با ما
      .mobile-extra
        .search-box
          input(type='text' placeholder='جستجو...')
          button.search-btn
            i.fas.fa-search
        .social-links
          a.social-link(href='http://instagram/cnc_bartar' target='_blank')
            i.fab.fa-instagram
          a.social-link(href='#' target='_blank')
            i.fab.fa-whatsapp
          a.social-link(href='#' target='_blank')
            i.fab.fa-telegram-plane
  .navbar-left
    .contact-numbers 
      a(href="tel:02166612134") 
        | 021-66612134
        i.fa.fa-phone
      a(href="tel:09121974633") 
        | 09121974633
        i.fa.fa-phone
    //- .search-box
    //-   input(type='text' placeholder='جستجو...')
    //-   button.search-btn
    //-     i.fas.fa-search
    .social-links
      a.social-link(href='http://instagram/cnc_bartar' target='_blank')
        i.fab.fa-instagram
      a.social-link(href='#' target='_blank')
        i.fab.fa-whatsapp
      a.social-link(href='#' target='_blank')
        i.fab.fa-telegram-plane



script.
  $(document).ready(() => {
    $('#contact-us-btn').click(() => {
      $('#contactus-form-modal').show();
    })
  })
script.
  // Mobile menu functionality
  const mobileMenuBtn = document.querySelector('.mobile-menu-btn');
  const navLinksContainer = document.querySelector('.nav-links-container');
  const dropdowns = document.querySelectorAll('.dropdown');
  const navbar = document.querySelector('.navbar');
  // Navbar scroll animation
  window.addEventListener('scroll', () => {
    if (window.scrollY > 50) {
      navbar.style.margin = '1vw';
      navbar.style.background = 'rgba(255, 255, 255, 0.95)';
    } else {
      navbar.style.margin = '3vw';
      navbar.style.background = 'rgba(255, 255, 255, 0.9)';
    }
  });

  mobileMenuBtn.addEventListener('click', () => {
    mobileMenuBtn.classList.toggle('active');
    navLinksContainer.classList.toggle('active');
  });

  // Handle dropdowns in mobile view
  dropdowns.forEach(dropdown => {
    const dropdownLink = dropdown.querySelector('a');
    const dropdownContent = dropdown.querySelector('.dropdown-content');

    dropdownLink.addEventListener('touchend', function(e) {
      if (window.innerWidth <= 768) {
        e.preventDefault();
        e.stopPropagation();

        // Close other dropdowns
        dropdowns.forEach(otherDropdown => {
          if (otherDropdown !== dropdown) {
            otherDropdown.classList.remove('active');
          }
        });

        // Toggle current dropdown
        dropdown.classList.toggle('active');

        // Ensure the dropdown toggle stays in view
        setTimeout(() => {
          // Scroll the nav-links-container so the dropdownLink is fully visible
          const container = navLinksContainer;
          const linkRect = dropdownLink.getBoundingClientRect();
          const containerRect = container.getBoundingClientRect();

          if (linkRect.top < containerRect.top) {
            // If link is above the visible area, scroll up
            container.scrollTop += linkRect.top - containerRect.top - 10;
          } else if (linkRect.bottom > containerRect.bottom) {
            // If link is below the visible area, scroll down
            container.scrollTop += linkRect.bottom - containerRect.bottom + 10;
          }
        }, 10);
      }
    });

    // Prevent clicks inside dropdown from bubbling up
    dropdownContent.addEventListener('click', (e) => {
      e.stopPropagation();
    });
  });

  // Handle link clicks in mobile view
  const mobileLinks = document.querySelectorAll('.nav-links a, .dropdown-content a');
  mobileLinks.forEach(link => {
    link.addEventListener('click', (e) => {
      if (window.innerWidth <= 768) {
        // Only prevent default for dropdown toggles
        if (!link.parentElement.classList.contains('dropdown')) {
          // Close mobile menu after clicking a link
          mobileMenuBtn.classList.remove('active');
          navLinksContainer.classList.remove('active');
          // Reset all dropdowns
          dropdowns.forEach(dropdown => dropdown.classList.remove('active'));
        }
      }
    });
  });

  // Close mobile menu when clicking outside
  document.addEventListener('click', (e) => {
    if (!navLinksContainer.contains(e.target) && !mobileMenuBtn.contains(e.target)) {
      mobileMenuBtn.classList.remove('active');
      navLinksContainer.classList.remove('active');
      // Reset all dropdowns
      dropdowns.forEach(dropdown => dropdown.classList.remove('active'));
    }
  });

  // Close mobile menu when window is resized above mobile breakpoint
  window.addEventListener('resize', () => {
    if (window.innerWidth > 768) {
      mobileMenuBtn.classList.remove('active');
      navLinksContainer.classList.remove('active');
      dropdowns.forEach(dropdown => dropdown.classList.remove('active'));
    }
  });

  // Dropdown handling for all dropdowns
  dropdowns.forEach(dropdown => {
    const dropdownContent = dropdown.querySelector('.dropdown-content');
    let isDropdownOpen = false;
    let timeoutId;

    function showDropdown() {
      isDropdownOpen = true;
      dropdownContent.style.display = 'flex';
      if (timeoutId) {
        clearTimeout(timeoutId);
      }
    }

    function hideDropdown() {
      timeoutId = setTimeout(() => {
        isDropdownOpen = false;
        dropdownContent.style.display = 'none';
      }, 200);
    }

    dropdown.addEventListener('mouseenter', showDropdown);
    dropdownContent.addEventListener('mouseenter', showDropdown);
    
    dropdown.addEventListener('mouseleave', hideDropdown);
    dropdownContent.addEventListener('mouseleave', hideDropdown);
  });